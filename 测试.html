<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片上传</title>
    <style>
        #preview {
            width: 100%;
            max-width: 1280px;
            height: 320px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-gap: 10px;
            margin-bottom: 10px;
        }
        .image-container {
            position: relative;
            text-align: center;
        }
        img {
            width: 100%;
            height: auto;
            object-fit: cover;
        }
        .delete-button {
            display: none;
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(255, 0, 0, 0.7);
            color: white;
            font-size: 12px;
            padding: 2px 4px;
            cursor: pointer;
            border-radius: 50%;
        }
        .image-container:hover .delete-button {
            display: block;
        }
        .filename {
            font-size: 12px;
            word-wrap: break-word;
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>上传图片</h1>
    <div id="preview"></div>
    <form action="/upload" method="post" enctype="multipart/form-data">
        <input type="file" name="images" accept="image/*" multiple onchange="loadFiles(event)">
        <br>
        <input type="submit" value="上传图片">
    </form>

    <script>
        function loadFiles(event) {
            var files = event.target.files;
            var preview = document.getElementById('preview');

            for (var i = 0; i < files.length; i++) {
                var reader = new FileReader();
                reader.onload = (function(file) {
                    return function(e) {
                        var imageContainer = document.createElement('div');
                        imageContainer.classList.add('image-container');
                        
                        var img = document.createElement('img');
                        img.src = e.target.result;
                        img.addEventListener('dblclick', function() {
                            var newWindow = window.open('', '_blank');
                            newWindow.document.write('<html><head><title>图片预览</title></head><body style="margin:0"><img src="' + img.src + '" style="width: 100%; height: auto"></body></html>');
                        });

                        var deleteButton = document.createElement('span');
                        deleteButton.innerText = 'x';
                        deleteButton.classList.add('delete-button');
                        deleteButton.addEventListener('click', function() {
                            preview.removeChild(imageContainer);
                        });

                        var filename = document.createElement('div');
                        filename.classList.add('filename');
                        filename.innerText = file.name;

                        imageContainer.appendChild(img);
                        imageContainer.appendChild(deleteButton);
                        imageContainer.appendChild(filename);
                        preview.appendChild(imageContainer);
                    };
                })(files[i]);
                reader.readAsDataURL(files[i]);
            }
        }
    </script>
</body>
</html>
